<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      function EventEmitter() {
        this._maxListeners = 10
        this._events = Object.create(null)
      }

      // prepend添加到事件队列头部
      EventEmitter.prototype.addEventListener = function (
        type,
        listener,
        prepend
      ) {
        if (!this._events) {
          this._events = Object.create(null)
        }
        if (this._events[type]) {
          if (prepend) {
            this._events[type].unshift(listener)
          } else {
            this._events[type].push(listener)
          }
        } else {
          this._events[type] = [listener]
        }
      }
      EventEmitter.prototype.removeEventListener = function (type, listener) {
        if (Array.isArray(this._events[type])) {
          if (!listener) {
            this._events[type] = []
          } else {
            this._events[type] = this._events[type].filter(
              (e) => e.origin !== listener && e !== listener
            )
          }
        }
      }
      EventEmitter.prototype.once = function (type, listener) {
        const only = (...args) => {
          listener.apply(this, args)
          this.removeEventListener(type, listener)
        }
        // 用于标识 一次绑定
        only.origin = listener
        this.addEventListener(type, only)
      }
      EventEmitter.prototype.emit = function (type, ...args) {
        if (Array.isArray(this._events[type])) {
          // 找到该分类下的事件执行
          this._events[type].forEach((fn) => {
            fn.apply(this, args)
          })
        }
      }
      EventEmitter.prototype.setMaxListener = function (count) {
        this._maxListeners = count
      }

      var emitter = new EventEmitter()

      var onceListener = function (args) {
        console.log('我只能被执行一次', args, this)
      }

      var listener = function (args) {
        console.log('我是一个listener', args, this)
      }

      emitter.once('click', onceListener)
      emitter.addEventListener('click', listener)

      emitter.emit('click', '参数')
      emitter.emit('click')

      emitter.removeEventListener('click', listener)
      emitter.emit('click')
    </script>
    <script src="./数组乱序-洗牌算法.js"></script>
  </body>
</html>
